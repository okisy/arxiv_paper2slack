# arxiv_paper2slack

## 概要
ArxivのオープンAPIを使って論文を探して、ChatGPTに要約してもらった文章をSlackのbotに投げてもらうコードです。

## ローカルでの環境構築
ローカルで実行してみたい場合は、まず以下で[uv](https://github.com/astral-sh/uv)を使って必要なライブラリをインストールします。

```
$ uv pip install -r requirements.txt
```


その後、以下で実行してください。

```
$ python lambda_function.py
```

## 環境構築関連（AWS）

### GitHub ActionsとECRへの自動デプロイ 🚀

このセクションでは、GitHub Actionsを使ってDockerイメージをビルドし、Amazon ECRに自動でプッシュするワークフローについて説明します。

---

### 1. GitHub Actionsでの自動プッシュ

プロジェクトのルートにある`.github/workflows/ci-cd.yml`で設定したGitHub Actionsのワークフローにより、`main`ブランチへのプッシュをトリガーに以下のプロセスが自動で実行されます。

1.  **Dockerイメージのビルド**: Lambdaの実行環境に合わせて、`linux/amd64`アーキテクチャでDockerイメージがビルドされます。
2.  **ECRへのログイン**: AWSの認証情報を使ってECRにログインします。
3.  **イメージのプッシュ**: ビルドされたDockerイメージがECRリポジトリにプッシュされます。

手動で`docker push`を実行する必要はありません。ワークフローが完了すると、最新のイメージがECRに登録されます。

---

### 2. AWS Lambdaでの設定

ECRへのイメージプッシュが自動化されたら、Lambda関数は一度だけ設定すればOKです。

#### a. Lambda関数の作成

- AWS Lambdaコンソールで「**関数の作成**」をクリックします。
- 「**コンテナイメージ**」を選択し、関数名を入力します。
- 「**コンテナイメージの参照**」をクリックし、ECRにプッシュされたイメージを選択して「**作成**」します。

#### b. 環境変数の設定

日本語のタイトルや内容を扱う場合、文字コード関連のエラーを防ぐために環境変数を設定します。

- Lambda関数の「**設定**」タブの「**環境変数**」セクションで、「**編集**」をクリックします。
- 以下のキーと値を追加します。
    - **キー**: `LANG`
    - **値**: `C.UTF-8`
    - その他，`SLACK_API_TOKEN`と`OPENAI_API_KEY`も設定すること

#### c. 実行時間の延長

デフォルトのタイムアウト時間では処理が完了しない場合があります。

- Lambda関数の「**設定**」タブの「**一般設定**」セクションで、「**編集**」をクリックします。
- 「**タイムアウト**」を任意の値（例：1分以上）に設定します。

---

### 3. 定期実行の設定（オプション）

Lambda関数を定期的に実行したい場合は、Amazon EventBridgeでスケジュールルールを設定します。

- Amazon EventBridgeのコンソールで「**ルールを作成**」をクリックします。
- スケジュールを設定し、ターゲットとして作成したLambda関数を選択します。